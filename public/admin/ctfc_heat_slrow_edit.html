<link rel="stylesheet" href="layui/css/layui.css" />
<body class="layui-layout-body">
  <div style="padding: 15px">
    <form class="layui-form" action="">
      <div class="layui-form-item">
        <h2>赛道分配与结果录入</h2>
      </div>
      <div class="layui-form-item" hidden>
        <label class="layui-form-label">ID</label>
        <div class="layui-input-inline">
          <input
            placeholder="请输入"
            class="layui-input"
            type="ID"
            id="ID"
            name="ID"
            disabled
          />
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">组别</label>
        <div class="layui-input-inline">
          <input
            placeholder="请输入"
            class="layui-input"
            type="text"
            id="ItemAgeGroupSex"
            name="ItemAgeGroupSex"
            disabled
          />
        </div>
      </div>
      <div class="layui-form-item layui-show-sm-block">
        <label class="layui-form-label">参赛运动员</label>
        <div class="layui-input-block">
          <input
            placeholder="请输入"
            class="layui-input"
            type="text"
            id="Players"
            name="Players"
            disabled
          />
        </div>
      </div>
      <div class="layui-form-item layui-show-sm-block">
        <label class="layui-form-label">ItemID</label>
        <div class="layui-input-block">
          <input
            placeholder="请输入"
            class="layui-input"
            type="text"
            id="ItemID"
            name="ItemID"
            disabled
          />
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">EventID</label>
        <div class="layui-input-inline">
          <input
            placeholder="请输入"
            class="layui-input"
            type="text"
            id="EventID"
            name="EventID"
          />
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">HeatID</label>
        <div class="layui-input-inline">
          <input
            placeholder="请输入"
            class="layui-input"
            type="text"
            id="HeatID"
            name="HeatID"
          />
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">赛道</label>
        <div class="layui-input-inline">
          <input
            placeholder="请输入"
            class="layui-input"
            type="text"
            id="LaneNumber"
            name="LaneNumber"
          />
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">结果</label>
        <div class="layui-input-inline">
          <input
            placeholder="请输入"
            class="layui-input"
            type="text"
            id="Result"
            name="Result"
          />
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">备注</label>
        <div class="layui-input-inline">
          <input
            placeholder="请输入"
            class="layui-input"
            type="text"
            id="Note"
            name="Note"
          />
        </div>
      </div>

      <div class="layui-form-item">
        <div class="layui-input-block">
          <button
            class="layui-btn"
            type="button"
            lay-submit=""
            lay-filter="edit-this-row"
          >
            立即修改
          </button>
        </div>
      </div>
    </form>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
  <script src="layui/layui.js"></script>
  <script>
    layui.use(["table", "form"], function () {
      var table = layui.table;
      var form = layui.form;
      var $ = layui.jquery;

      form.on("submit(edit-this-row)", function (data) {
        var index = parent.layer.getFrameIndex(window.name);

        // parse name: eg: Xiao # 101 -> Xiao
        const playerName = data.field.Players.split("#")[0].trim();

        axios
          .post("../ctfcheat/edit", {
            PlayerName: playerName,
            ItemID: data.field.ItemID,
            EventID: data.field.EventID,
            HeatID: data.field.HeatID,
            LaneNumber: data.field.LaneNumber,
            Result: data.field.Result,
            Note: data.field.Note,
          })

          .then(function (response) {
            if (response.data.success) {
              layer.msg(
                "修改成功",
                {
                  icon: 1,
                  time: 1500,
                },
                function () {
                  parent.layer.close(index);
                }
              );
            } else {
              alert(response.data.message);
            }
          })
          .catch(function (error) {
            console.log(error);
          });
      });
    });
  </script>
</body>
