<!-- å†…å®¹ä¸»ä½“åŒºåŸŸ -->
<link rel="stylesheet" href="layui/css/layui.css" />
<style>
  .layui-table-cell {
    height: 80px;
    /* line-height: 80px; */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .layui-table-cell img {
    max-height: 70px;
  }
</style>
<div>
  <div class="layui-tab">
    <div class="layui-tab-content">
      <div class="layui-input-inline">
        <div class="layui-input-inline">
          <button id="add" class="layui-btn layui-btn-normal">
            æ‰¹é‡å½•å…¥å†å±Šæˆç»©
          </button>
        </div>
      </div>
      <form class="layui-form layui-inline">
        <div class="layui-input-inline">
          <div class="layui-input-inline">
            <input
              type="text"
              name="Name"
              value=""
              placeholder="ğŸ” å§“åæŸ¥è¯¢ (eg. zhang)"
              class="layui-input"
              lay-affix="clear"
            />
          </div>
        </div>
      </form>
      <table class="layui-hide" id="test" lay-filter="test"></table>
      <script type="text/html" id="toolbarDemo"></script>
      <script type="text/html" id="show-img">
        <img src="../uploads/{{d.PhotoSrc}}" alt="å›¾ç‰‡å" />
      </script>
      <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="edit">ä¿®æ”¹</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"
          >åˆ é™¤</a
        >
      </script>
      <script type="text/html" id="shenhe">
        {{# if(d.Approval==0){ }}
        <a class="layui-btn layui-btn layui-btn-xs" lay-event="tongguo">é€šè¿‡</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="bohui"
          >é©³å›</a
        >
        {{# } else { }}
        <a class="layui-btn layui-btn-disabled layui-btn-xs">å·²é€šè¿‡</a>
        {{# } }}
      </script>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
<script src="layui/layui.js"></script>
<script>
  function tongguo(ids, passed) {
    console.log(ids);
    console.log(passed);
    $.ajax({
      url: "../ctfcplayer/passapp",
      type: "Post",
      dataType: "json",
      data: {
        PlayerIDs: ids,
        Passed: passed,
      },
      header: {
        Accept: "application/json",
      },
      success: function (data) {
        layer.msg(
          "æˆåŠŸå®¡æ ¸é€šè¿‡" +
            data["affectedRows"] +
            "ä¸ªè¿åŠ¨å‘˜ï¼Œå‘é€äº†" +
            data["affectedEmails"] +
            "ä¸ªé‚®ä»¶",
          {
            icon: 1,
            time: 1200,
          },
          function () {
            // location.reload();
            reloadPage();
          }
        );
      },
      error: function (xhr) {
        if (xhr.status == 401) top.location.href = "login.html";
      },
    });
  }

  function reloadPage() {
    var table = layui.table;
    var form = layui.form;
    var currentPage = 1;

    if (table.cache["test"]) {
      currentPage = table.cache["test"].curr;
    }
    table.reload("test", {
      url: "../CTFCPlayer?all=1",
      page: {
        curr: currentPage,
      },
    });
  }

  const tableCols = [
    [
      {
        type: "checkbox",
        fixed: "center",
        width: 90,
      },
      {
        field: "Name",
        title: "å§“å",
        width: 200,
      },
      {
        field: "Sex",
        title: "æ€§åˆ«",
        width: 60,
      },
      {
        field: "TeamName",
        title: "é˜Ÿä¼åç§°",
        width: 90,
      },
      {
        field: "GroupAgeID",
        title: "å¹´é¾„ç»„",
        width: 100,
      },
      {
        filed: "Result",
        tilte: "æˆç»©",
        width: 100,
        
      }
      // {
      //   field: "Approval",
      //   title: "å®¡æ ¸",
      //   width: 130,
      //   toolbar: "#shenhe",
      // },
      // {
      //   title: "æ“ä½œ",
      //   fixed: "right",
      //   width: 122,
      //   toolbar: "#barDemo",
    // },
    ],
  ];

  const filterData = function (data, name) {
    return data.filter(function (r) {
      return r.Name.toLowerCase().includes(name);
    });
  };

  const renderTable = function (
    limit = 20,
    filterMode = false,
    filterValue = ""
  ) {
    layui.table.render({
      elem: "#test",
      url: "../CTFCPlayer?all=1",
      parseData: function (res) {
        if (filterMode) {
          res.data = filterData(res.data, filterValue);
          res.totalcount = res.data.length;
        }
        return {
          code: 0, //è§£ææ¥å£çŠ¶æ€
          msg: "", //è§£ææç¤ºæ–‡æœ¬
          count: res.totalcount, //è§£ææ•°æ®é•¿åº¦
          data: res.data, //è§£ææ•°æ®åˆ—è¡¨
        };
      },
      method: "get",
      request: {
        pageName: "page", //é¡µç çš„å‚æ•°åç§°ï¼Œé»˜è®¤ï¼špage
        limitName: "pagesize", //æ¯é¡µæ•°æ®é‡çš„å‚æ•°åï¼Œé»˜è®¤ï¼šlimit
      },
      title: "ç”¨æˆ·æ•°æ®è¡¨",
      cols: tableCols,
      limit: limit,
      page: {
        //æ”¯æŒä¼ å…¥ laypage ç»„ä»¶çš„æ‰€æœ‰å‚æ•°ï¼ˆæŸäº›å‚æ•°é™¤å¤–ï¼Œå¦‚ï¼šjump/elemï¼‰ - è¯¦è§æ–‡æ¡£
        layout: ["count", "prev", "page", "next", "skip"], //è‡ªå®šä¹‰åˆ†é¡µå¸ƒå±€
        //,curr: 5 //è®¾å®šåˆå§‹åœ¨ç¬¬ 5 é¡µ
        groups: 1, //åªæ˜¾ç¤º 1 ä¸ªè¿ç»­é¡µç 
        first: false, //ä¸æ˜¾ç¤ºé¦–é¡µ
        last: false, //ä¸æ˜¾ç¤ºå°¾é¡µ
      },
    });
  };

  layui.use(["table", "form"], function () {
    var table = layui.table;
    var form = layui.form;

    renderTable();

    $("#tongguoAll").click(function () {
      var mycars = "";
      var data = table.checkStatus("test").data; //idTest å³ä¸ºåŸºç¡€å‚æ•° id å¯¹åº”çš„å€¼
      mycars = "";
      if (data.length === 0) {
        layer.alert("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé¡¹ç›®");
      } else {
        for (var i = 0; i < data.length; i++) {
          if (i === data.length - 1) {
            if (data[i].Approval === 0) {
              mycars += data[i].ID;
            }
          } else {
            if (data[i].Approval === 0) {
              mycars += data[i].ID + ",";
            }
          }
        }
        tongguo(mycars, 1);
      }
    });

    $("#add").click(function () {
      var index = layer.open({
        type: 2,
        title: "æ·»åŠ å†å±Šè¿åŠ¨å‘˜ä¸æˆç»©",
        shadeClose: true,
        shade: 0.8,
        offset: "0px",
        area: ["100%", "100%"],
        content: "ctfc_previous_player_add.html",
        success: function (layero, index) {
          // layer.iframeAuto(index);
        },
        end: function () {
          location.reload();
        },
      });
      layer.full(index);
      window.sessionStorage.setItem("ctfc_player_index", index);
      //æ”¹å˜çª—å£å¤§å°æ—¶ï¼Œé‡ç½®å¼¹çª—çš„å®½é«˜ï¼Œé˜²æ­¢è¶…å‡ºå¯è§†åŒºåŸŸï¼ˆå¦‚F12è°ƒå‡ºdebugçš„æ“ä½œï¼‰
      $(window).on("resize", function () {
        layer.full(window.sessionStorage.getItem("ctfc_player_index"));
      });
    });

    table.on("tool(test)", function (obj) {
      //æ³¨ï¼štoolæ˜¯å·¥å…·æ¡äº‹ä»¶åï¼Œtestæ˜¯tableåŸå§‹å®¹å™¨çš„å±æ€§ lay-filter="å¯¹åº”çš„å€¼"
      var data = obj.data; //è·å¾—å½“å‰è¡Œæ•°æ®
      var layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼ï¼ˆä¹Ÿå¯ä»¥æ˜¯è¡¨å¤´çš„ event å‚æ•°å¯¹åº”çš„å€¼ï¼‰
      var tr = obj.tr; //è·å¾—å½“å‰è¡Œ tr çš„DOMå¯¹è±¡
      // console.log(data.ID);

      if (layEvent === "edit") {
        //æŸ¥çœ‹
        console.log(obj.data);
        var index = layer.open({
          type: 2,
          title: "ä¿®æ”¹ç”°å¾„é€‰æ‰‹",
          shadeClose: true,
          shade: 0.8,
          offset: "0px",
          area: ["100%", "100%"],
          content: "ctfc_player_edit.html",
          success: function (layero, index) {
            // layer.iframeAuto(index);
            var body = layer.getChildFrame("body", index);
            body.find("#Name").val(data.Name);
            body.find("#Sex").val(data.Sex);
            //body.find('#Number').val(data.Number)
            body.find("#Birthday").val(data.Birthday);

            body.find("#PhotoSrc").val(data.PhotoSrc);
            body.find("#Email").val(data.Email);
            //                        body.find('#TeamID').val(data.TeamID)
            //      body.find('#SeasonID').attr("value", data.SeasonID)

            body.find("#demo1").attr("src", "../uploads/" + data.PhotoSrc);
            body.find("#ID").val(data.ID);

            //                        body.find('#TeamID').attr("value", data.TeamID)
          },
          end: function () {
            // location.reload();
            reloadPage();
          },
        });
        layer.full(index);
        window.sessionStorage.setItem("ctfc_player_index", index);
        //æ”¹å˜çª—å£å¤§å°æ—¶ï¼Œé‡ç½®å¼¹çª—çš„å®½é«˜ï¼Œé˜²æ­¢è¶…å‡ºå¯è§†åŒºåŸŸï¼ˆå¦‚F12è°ƒå‡ºdebugçš„æ“ä½œï¼‰
        $(window).on("resize", function () {
          layer.full(window.sessionStorage.getItem("ctfc_player_index"));
        });
      } else if (layEvent === "del") {
        layer.confirm(
          "ç¡®è®¤åˆ é™¤",
          {
            btn: ["ç¡®è®¤", "å–æ¶ˆ"],
            offset: ["100px"], //æŒ‰é’®
          },
          function () {
            axios
              .delete("../CTFCPlayer/" + data.ID, {})
              .then(function (response) {
                console.log(response);
              })
              .catch(function (error) {
                console.log(error);
              });
            layer.msg(
              "åˆ é™¤æˆåŠŸ",
              {
                icon: 1,
                time: 1200,
              },
              function () {
                // location.reload();
                reloadPage();
              }
            );
          },
          function () {}
        );
      } else if (layEvent === "tongguo") {
        layer.confirm(
          "ç¡®è®¤è¦å®¡æ ¸é€šè¿‡å—ï¼Ÿ",
          {
            btn: ["ç¡®è®¤", "å–æ¶ˆ"], //æŒ‰é’®
          },
          function () {
            layer.msg("æ­£åœ¨é€šè¿‡...", { icon: 7 });
            tongguo(data.ID, 1);
          },
          function () {}
        );
      } else if (layEvent === "bohui") {
        layer.confirm(
          "ç¡®è®¤è¦é©³å›å—ï¼Ÿ",
          {
            btn: ["ç¡®è®¤", "å–æ¶ˆ"], //æŒ‰é’®
          },
          function () {
            layer.msg("æ­£åœ¨é©³å›...", { icon: 7 });
            tongguo(data.ID, 0);
          },
          function () {}
        );
      }
    });

    // Inside the 'layui.use(["table", "form"]' block

    let timer; // Declare a variable to hold the timer outside the event handler

    // Attach a keyup event handler to the input
    $('input[name="Name"]').on("keyup", function () {
      const name = $(this).val().toLowerCase();
      // Clear the existing timer
      clearTimeout(timer);
      const allData = { data: [] };
      // Set a new timer
      timer = setTimeout(function () {
        // Reload the table data from the server, passing the name as a parameter
        if (!name) {
          renderTable();
        } else {
          renderTable(500, true, name);
        }
      }, 500); // Wait for 1 second of inactivity before executing
    });
  });
  // axios.get('../CTFCSeason', {}).then(function (response) {
  //     console.log(response);
  //     $.each(response.data.data, function (index, item) {
  //         $('#Season').append('<option value="' + item.SeasonID + '">' + item.SeasonName + '</option>');
  //     });
  //     form.render();
  // })
  //     .catch(function (error) {
  //         console.log(error);
  //     });
  // axios.get('../CTFCTeam', {}).then(function (response) {
  //     console.log(response);
  //     $.each(response.data.data, function (index, item) {
  //         $('#Team').append('<option value="' + item.ID + '">' + item.Name + '</option>');
  //     });
  //     form.render();
  // })
  //     .catch(function (error) {
  //         console.log(error);
  //     });
  // form.on('select(Season)', function (data) {
  //     table.reload('test', {
  //         // where: { //è®¾å®šå¼‚æ­¥æ•°æ®æ¥å£çš„é¢å¤–å‚æ•°ï¼Œä»»æ„è®¾
  //         //     // SeasonID: data.value,
  //         //     url: '../ctfcseason/' + data.value + '/ctfcplayer',
  //         // },
  //         url: '../ctfcseason/' + data.value + '/ctfcplayer',
  //         page: {
  //             curr: 1 //é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹
  //         }
  //     });
  // });
  // form.on('select(Team)', function (data) {
  //     table.reload('test', {
  //         // where: { //è®¾å®šå¼‚æ­¥æ•°æ®æ¥å£çš„é¢å¤–å‚æ•°ï¼Œä»»æ„è®¾
  //         //     // SeasonID: data.value,
  //         //     url: '../ctfcseason/' + data.value + '/ctfcplayer',
  //         // },
  //         url: '../ctfcteam/' + data.value + '/ctfcplayer',
  //         page: {
  //             curr: 1 //é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹
  //         }
  //     });
  // })
</script>

<!-- å†…å®¹ä¸»ä½“åŒºåŸŸ
<link rel="stylesheet" href="layui/css/layui.css" />
<style>
  .layui-table-cell {
    height: 80px;
    line-height: 80px;
  }

  .layui-table-cell img {
    max-height: 70px;
  }
</style>
<div>
  <div class="layui-tab">
    <div class="layui-tab-content">
      <div class="layui-input-inline" style="">
        <div class="layui-input-inline">
          <button id="edit" class="layui-btn layui-btn-normal">
            æ‰¹é‡åˆ†é…èµ›é“/ç»“æœå½•å…¥
          </button>
        </div>
      </div>
      <div class="layui-input-inline">
        <form class="layui-form" action="">
          <select id="Item" name="Item" lay-verify="" lay-filter="ItemClick">
            <option value="">æŸ¥çœ‹é¡¹ç›®ç»„åˆ«</option>
          </select>
        </form>
      </div>
      <div class="layui-input-inline">
        <form class="layui-form" action="">
          <select
            id="IsSingle"
            name="IsSingle"
            lay-verify=""
            lay-filter="IsSingleClick"
          >
            <option value="">æŸ¥çœ‹å•é¡¹æ¥åŠ›</option>
            <option value="1">å•é¡¹</option>
            <option value="0">æ¥åŠ›</option>
          </select>
        </form>
      </div>
      <div class="layui-input-inline">
        <div class="layui-input-inline">
          <button id="reassign" class="layui-btn layui-btn-normal">
            æ›´æ”¹Event ID
          </button>
        </div>
      </div>
      <div class="layui-input-inline">
        <button id="timing" class="layui-btn layui-btn-warm">
          ç”Ÿæˆç”µè®¡æ—¶è¡¨æ ¼
        </button>
      </div>

      <table class="layui-hide" id="test" lay-filter="test"></table>
      <script type="text/html" id="toolbarDemo"></script>
      <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="edit-slrow">èµ›é“åˆ†é…</a>
      </script>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
<script src="layui/layui.js"></script>
<script>
  /**
   * return whether a item is a track match
   * true, track game
   * false, field game
   *
   * TODO: This is a fragile solution to match the item name.
   * Long term, the source of truth should be defined in Database (as Item.isTrack as boolean)
   */

  function isTrackItem(itemName) {
    const FIELDITEM = ["è·³é«˜", "ä¸‰çº§è·³è¿œ", "é“…çƒ", "è·³è¿œ"];

    return !FIELDITEM.includes(itemName);
  }

  layui.use(["table", "form"], function () {
    var table = layui.table;
    var form = layui.form;
    table.render({
      elem: "#test",
      url: "../ctfcheatview",
      parseData: function (res) {
        return {
          code: 0, //è§£ææ¥å£çŠ¶æ€
          msg: "", //è§£ææç¤ºæ–‡æœ¬
          count: res.totalcount, //è§£ææ•°æ®é•¿åº¦
          data: res.data, //è§£ææ•°æ®åˆ—è¡¨
        };
      },
      method: "get",
      request: {
        pageName: "page", //é¡µç çš„å‚æ•°åç§°ï¼Œé»˜è®¤ï¼špage
        limitName: "pagesize", //æ¯é¡µæ•°æ®é‡çš„å‚æ•°åï¼Œé»˜è®¤ï¼šlimit
      },
      title: "ç”¨æˆ·æ•°æ®è¡¨",
      cols: [
        [
          {
            field: "ID",
            title: "ID",
            width: 80,
            fixed: "left",
            unresize: true,
            sort: true,
          },
          {
            field: "EventID",
            title: "EventID",
            width: 100,
            sort: true,
          },

          {
            field: "HeatID",
            title: "HeatID",
            width: 100,
            sort: true,
          },

          {
            field: "LaneNumber",
            title: "é“æ¬¡",
            width: 80,
            sort: true,
          },
          {
            field: "TeamName",
            title: "é˜Ÿä¼åç§°",
            width: 150,
            sort: true,
          },
          {
            field: "ItemAgeGroupSex",
            title: "ç»„åˆ«",
            width: 200,
            sort: true,
          },
          {
            field: "Players",
            title: "å‚èµ›è¿åŠ¨å‘˜",
            width: 450,
          },
          {
            field: "Result",
            title: "æˆç»©(m)",
            width: 150,
            sort: true,
            templet: function (d) {
              const isTimeSpan = isTrackItem(d.ItemName);
              if (isTimeSpan) {
                return `<span style="color: #999">N/A</span>`;
              }
              return `<span style="color: #16B777">${d.Result}</span>`;
            },
          },
          {
            field: "TimeSpan",
            title: "æˆç»©(00:00.00)",
            width: 150,
            sort: true,
            templet: function (d) {
              const isTimeSpan = isTrackItem(d.ItemName);
              if (!isTimeSpan) {
                return `<span style="color: #999">N/A</span>`;
              }
              return `<span style="color: #16B777">${
                d.TimeSpan ? d.TimeSpan.substring(3) : "00:00.00"
              }</span>`;
            },
          },
          {
            field: "Note",
            title: "å¤‡æ³¨",
            width: 150,
          },
          {
            title: "æ“ä½œ",
            width: 150,
            toolbar: "#barDemo",
          },
        ],
      ],
      limit: 20,
      page: {
        //æ”¯æŒä¼ å…¥ laypage ç»„ä»¶çš„æ‰€æœ‰å‚æ•°ï¼ˆæŸäº›å‚æ•°é™¤å¤–ï¼Œå¦‚ï¼šjump/elemï¼‰ - è¯¦è§æ–‡æ¡£
        layout: ["count", "prev", "page", "next", "skip"], //è‡ªå®šä¹‰åˆ†é¡µå¸ƒå±€
        //,curr: 5 //è®¾å®šåˆå§‹åœ¨ç¬¬ 5 é¡µ
        groups: 1, //åªæ˜¾ç¤º 1 ä¸ªè¿ç»­é¡µç 
        first: false, //ä¸æ˜¾ç¤ºé¦–é¡µ
        last: false, //ä¸æ˜¾ç¤ºå°¾é¡µ
      },
    });

    $("#edit").click(function () {
      var index = layer.open({
        type: 2,
        title: "æ‰¹é‡åˆ†é…èµ›é“/ç»“æœå½•å…¥",
        shadeClose: true,
        shade: 0.8,
        offset: "0px",
        area: ["100%", "100%"],
        content: "ctfc_heat_edit.html",
        success: function (layero, index) {
          // layer.iframeAuto(index);
        },
        end: function () {
          location.reload();
        },
      });
      layer.full(index);
      window.sessionStorage.setItem("ctfc_heat_index", index);
      //æ”¹å˜çª—å£å¤§å°æ—¶ï¼Œé‡ç½®å¼¹çª—çš„å®½é«˜ï¼Œé˜²æ­¢è¶…å‡ºå¯è§†åŒºåŸŸï¼ˆå¦‚F12è°ƒå‡ºdebugçš„æ“ä½œï¼‰
      $(window).on("resize", function () {
        layer.full(window.sessionStorage.getItem("ctfc_heat_index"));
      });
    });

    $("#reassign").click(function () {
      layer.confirm(
        "ç¡®è®¤é‡æ–°åˆ†é…eventIDå—ï¼Ÿ",
        {
          btn: ["ç¡®è®¤", "å–æ¶ˆ"], //æŒ‰é’®
        },
        function () {
          $.ajax({
            url: "../ctfcheat/reassign",
            type: "post",
            dataType: "json",
            header: {
              Accept: "application/json",
            },
            success: function (data) {
              console.log("success");
            },
            error: function (xhr) {
              console.log(xhr);
            },
          });
          layer.msg(
            "é‡æ–°åˆ†é…æˆåŠŸ",
            {
              icon: 1,
              time: 1200,
            },
            function () {
              location.reload();
            }
          );
        },
        function () {}
      );
    });

    table.on("tool(test)", function (obj) {
      //æ³¨ï¼štoolæ˜¯å·¥å…·æ¡äº‹ä»¶åï¼Œtestæ˜¯tableåŸå§‹å®¹å™¨çš„å±æ€§ lay-filter="å¯¹åº”çš„å€¼"
      var data = obj.data; //è·å¾—å½“å‰è¡Œæ•°æ®
      var layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼ï¼ˆä¹Ÿå¯ä»¥æ˜¯è¡¨å¤´çš„ event å‚æ•°å¯¹åº”çš„å€¼ï¼‰
      var tr = obj.tr; //è·å¾—å½“å‰è¡Œ tr çš„DOMå¯¹è±¡
      console.log(data.ID);

      if (layEvent === "edit-slrow") {
        //æŸ¥çœ‹
        console.log(obj.data);
        var index = layer.open({
          type: 2,
          title: "èµ›é“åˆ†é…ä¸ç»“æœå½•å…¥",
          shadeClose: true,
          shade: 0.8,
          offset: "0px",
          area: ["100%", "100%"],
          content: "ctfc_heat_slrow_edit.html",
          success: function (layero, index) {
            layer.iframeAuto(index);
            var body = layer.getChildFrame("body", index);
            body.find("#EventID").val(obj.data.EventID);
            body.find("#HeatID").val(obj.data.HeatID);
            body.find("#ID").val(obj.data.ID);
            body.find("#LaneNumber").val(obj.data.LaneNumber);
            body.find("#Result").val(obj.data.Result);
            body.find("#Note").val(obj.data.Note);
            body.find("#ItemAgeGroupSex").val(obj.data.ItemAgeGroupSex);
            body.find("#Players").val(obj.data.Players);
            body.find("#TeamName").val(obj.data.TeamName);
            body.find("#ItemID").val(obj.data.ItemID);

            if (obj.data.TimeSpan) {
              const [hour, minute, second] = obj.data.TimeSpan.split(":");
              const [whole, fraction] = second.split(".");
              body.find("#result-hour").val(hour);
              body.find("#result-minute").val(minute);
              body.find("#result-second").val(whole);
              body.find("#result-fraction").val(fraction);
            }
          },
          end: function () {
            location.reload();
          },
        });
        layer.full(index);
        window.sessionStorage.setItem("ctfc_heat_index", index);
        //æ”¹å˜çª—å£å¤§å°æ—¶ï¼Œé‡ç½®å¼¹çª—çš„å®½é«˜ï¼Œé˜²æ­¢è¶…å‡ºå¯è§†åŒºåŸŸï¼ˆå¦‚F12è°ƒå‡ºdebugçš„æ“ä½œï¼‰
        $(window).on("resize", function () {
          layer.full(window.sessionStorage.getItem("ctfc_heat_index"));
        });
      }
    });

    // IsSingleçš„filter
    form.on("select(IsSingleClick)", function (data) {
      // Reset the select element to its initial state
      var selectElement = document.getElementById("Item");
      selectElement.selectedIndex = 0;
      form.render();

      table.reload("test", {
        url: "../CTFCheatview?IsSingle=" + data.value,
      });
    });

    // é¡¹ç›®item options : all the data are from ctfc_heat_view
    axios
      .get("../CTFCheatview", {})
      .then(function (response) {
        var uniqueValues = []; // Array to store unique ItemAgeGroupSex values
        $.each(response.data.data, function (index, elem) {
          if (!uniqueValues.includes(elem.ItemAgeGroupSex)) {
            uniqueValues.push(elem.ItemAgeGroupSex);
            $("#Item").append(
              '<option value="' +
                elem.ItemAgeGroupSex +
                '">' +
                elem.ItemAgeGroupSex +
                "</option>"
            );
          }
        });
        form.render();
      })
      .catch(function (error) {
        console.log(error);
      });

    // é¡¹ç›®çš„filter
    form.on("select(ItemClick)", function (data) {
      // Reset the select element to its initial state
      var selectElement = document.getElementById("IsSingle");
      selectElement.selectedIndex = 0;
      form.render();
      table.reload("test", {
        url: "../CTFCheatview?IAGSid=" + data.value,
      });
    });

    $("#timing").click(function () {
      window.location.href = "../ctfcheatcsv";
    });
  });
</script> -->

